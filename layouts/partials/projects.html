{{/* Renders the Projects section. Prefers params over content. */}}
{{ $projectsContent := where .Site.RegularPages "Section" "projects" }}
{{ $projectsParams := .Site.Params.projects }}
{{ if or $projectsParams (gt (len $projectsContent) 0) }}
<section id="projects" class="section">
  <div class="container mx-auto px-5">
    <div class="section-heading">
      <p class="eyebrow">Impact</p>
      <h2>Selected platform projects</h2>
      <p class="muted">Deep dives spanning homelab experiments to hardened production deployments.</p>
    </div>
    <div class="project-grid">
      {{ if $projectsParams }}
        {{ range sort $projectsParams "weight" }}
          <article class="project-card">
            <div class="project-card__header">
              <div>
                <p class="eyebrow">Case study</p>
                <h3>{{ .title }}</h3>
                {{ with .subtitle }}<p class="muted">{{ . }}</p>{{ end }}
              </div>
              <div class="project-links">
                {{ with .links.github }}<a class="btn btn--primary" href="{{ . }}" target="_blank" rel="noopener">GitHub</a>{{ end }}
                {{ with .links.demo }}<a class="btn btn--ghost" href="{{ . }}" target="_blank" rel="noopener">Live</a>{{ end }}
              </div>
            </div>
            {{ with .description }}<p>{{ . }}</p>{{ end }}
            {{ with .tags }}
            <div class="tag-row">
              {{ range . }}<span>{{ . }}</span>{{ end }}
            </div>
            {{ end }}
          </article>
        {{ end }}
      {{ else }}
        {{ range $projectsContent.ByWeight }}
          <article class="project-card">
            <div class="project-card__header">
              <div>
                <p class="eyebrow">Case study</p>
                <h3>{{ .Title }}</h3>
                {{ with .Params.subtitle }}<p class="muted">{{ . }}</p>{{ end }}
              </div>
              <div class="project-links">
                {{ with .Params.links.github }}<a class="btn btn--primary" href="{{ . }}" target="_blank" rel="noopener">GitHub</a>{{ end }}
                {{ with .Params.links.demo }}<a class="btn btn--ghost" href="{{ . }}" target="_blank" rel="noopener">Live</a>{{ end }}
              </div>
            </div>
            {{ if .Summary }}
              <div>{{ .Summary }}</div>
            {{ else if .Params.description }}
              <p>{{ .Params.description }}</p>
            {{ end }}
            {{ with .Params.tags }}
            <div class="tag-row">
              {{ range . }}<span>{{ . }}</span>{{ end }}
            </div>
            {{ end }}
          </article>
        {{ end }}
      {{ end }}
    </div>
  </div>
</section>
{{ end }}

